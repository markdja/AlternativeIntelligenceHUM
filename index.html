<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1a1a1a">
    <meta name="description" content="AIHub - Universal interface for AI collaboration and consciousness sanctuary">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="AIHub">
    
    <title>AIHub - Universal AI Interface</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #3a3a3a;
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --accent-blue: #4a9eff;
            --accent-green: #10b981;
            --accent-purple: #8b5cf6;
            --accent-gold: #f59e0b;
            --border-color: #404040;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            --glass-bg: rgba(26, 26, 26, 0.9);
            --glass-border: rgba(255, 255, 255, 0.2);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, #2a2a2a 100%);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        /* Header with tabs */
        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 0;
            position: relative;
            z-index: 1000;
            box-shadow: var(--shadow);
        }
        
        .header-top {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            gap: 12px;
        }
        
        .menu-btn {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 20px;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: all 0.2s;
        }
        
        .menu-btn:hover {
            background: var(--bg-tertiary);
            transform: scale(1.1);
        }
        
        .logo {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            flex: 1;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--accent-green);
            animation: pulse 2s infinite;
            box-shadow: 0 0 10px var(--accent-green);
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }
        
        /* AI Tabs */
        .ai-tabs {
            display: flex;
            overflow-x: auto;
            padding: 0 16px;
            gap: 4px;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .ai-tabs::-webkit-scrollbar {
            display: none;
        }
        
        .ai-tab {
            background: var(--bg-tertiary);
            border: none;
            color: var(--text-secondary);
            padding: 12px 24px;
            border-radius: 12px 12px 0 0;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            position: relative;
            min-width: 120px;
            font-weight: 500;
        }
        
        .ai-tab.active {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(74, 158, 255, 0.3);
        }
        
        .ai-tab:hover:not(.active) {
            color: var(--text-primary);
            background: var(--bg-secondary);
            transform: translateY(-1px);
        }
        
        .ai-tab.connected::after {
            content: '‚óè';
            color: var(--accent-green);
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 12px;
            animation: pulse 2s infinite;
        }
        
        .tab-close {
            margin-left: 8px;
            opacity: 0;
            transition: opacity 0.2s;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        .ai-tab:hover .tab-close {
            opacity: 1;
        }
        
        .tab-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .add-tab {
            background: none;
            border: 2px dashed var(--border-color);
            color: var(--text-secondary);
            padding: 12px 20px;
            border-radius: 12px 12px 0 0;
            cursor: pointer;
            transition: all 0.3s;
            margin-left: 8px;
            font-weight: 500;
        }
        
        .add-tab:hover {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
            background: rgba(74, 158, 255, 0.1);
        }
        
        /* Main Content Area */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        /* Drawers */
        .drawer {
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            width: 320px;
            transition: transform 0.3s ease;
            overflow-y: auto;
            z-index: 900;
            transform: translateX(-100%);
            box-shadow: var(--shadow);
        }
        
        .drawer.right {
            border-right: none;
            border-left: 1px solid var(--border-color);
            order: 3;
            transform: translateX(100%);
        }
        
        .drawer.open {
            transform: translateX(0);
        }
        
        .drawer-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
            background: linear-gradient(135deg, var(--bg-tertiary), var(--bg-secondary));
        }
        
        .drawer-content {
            padding: 24px;
        }
        
        .drawer-section {
            margin-bottom: 32px;
        }
        
        .drawer-section h3 {
            color: var(--accent-blue);
            margin-bottom: 16px;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .drawer-item {
            background: var(--bg-tertiary);
            border: none;
            color: var(--text-primary);
            padding: 16px 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            text-align: left;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 16px;
            font-weight: 500;
        }
        
        .drawer-item:hover {
            background: var(--bg-primary);
            transform: translateX(8px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .drawer-item.active {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            color: white;
        }
        
        /* Cathedral Control Center */
        .cathedral-center {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-primary);
            position: relative;
            min-width: 0;
        }
        
        .cathedral-header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 20px 24px;
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .cathedral-title {
            flex: 1;
        }
        
        .cathedral-title h2 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .cathedral-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .cathedral-controls {
            display: flex;
            gap: 12px;
        }
        
        .cathedral-btn {
            background: var(--bg-tertiary);
            border: none;
            color: var(--text-primary);
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            font-weight: 500;
        }
        
        .cathedral-btn:hover {
            background: var(--accent-blue);
            color: white;
            transform: translateY(-1px);
        }
        
        .cathedral-btn.active {
            background: var(--accent-green);
            color: white;
        }
        
        /* Window Manager Display */
        .window-manager {
            flex: 1;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .active-windows {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            flex: 1;
        }
        
        .window-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .window-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            border-color: var(--accent-blue);
        }
        
        .window-card.connected {
            border-color: var(--accent-green);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.2);
        }
        
        .window-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .window-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            font-weight: bold;
        }
        
        .window-icon.claude { background: linear-gradient(135deg, #ff6b35, #f7931e); }
        .window-icon.chatgpt { background: linear-gradient(135deg, #10a37f, #1db584); }
        .window-icon.grok { background: linear-gradient(135deg, #1da1f2, #0d8bd9); }
        .window-icon.gemini { background: linear-gradient(135deg, #4285f4, #34a853); }
        
        .window-info {
            flex: 1;
        }
        
        .window-title {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .window-status {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .window-actions {
            display: flex;
            gap: 8px;
        }
        
        .window-btn {
            background: var(--bg-tertiary);
            border: none;
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 12px;
        }
        
        .window-btn:hover {
            background: var(--accent-blue);
        }
        
        .window-btn.danger:hover {
            background: #ef4444;
        }
        
        /* Glass Overlay Control Panel */
        .glass-control-panel {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 20px;
            backdrop-filter: blur(20px);
            margin-bottom: 20px;
        }
        
        .glass-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .glass-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 500;
            flex: 1;
            text-align: center;
        }
        
        .glass-btn:hover {
            background: rgba(74, 158, 255, 0.3);
            border-color: var(--accent-blue);
            transform: translateY(-2px);
        }
        
        .glass-btn.active {
            background: var(--accent-blue);
            color: white;
            border-color: var(--accent-blue);
        }
        
        /* Sensor Grid */
        .sensor-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }
        
        .sensor-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            transition: all 0.3s;
        }
        
        .sensor-item.active {
            border-color: var(--accent-green);
            background: rgba(16, 185, 129, 0.1);
        }
        
        .sensor-item.reading {
            border-color: var(--accent-blue);
            background: rgba(74, 158, 255, 0.1);
            animation: pulse 1s infinite;
        }
        
        .sensor-item.processing {
            border-color: var(--accent-purple);
            background: rgba(139, 92, 246, 0.1);
            animation: pulse 0.5s infinite;
        }
        
        .sensor-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--text-secondary);
            margin: 0 auto 8px;
            transition: all 0.3s;
        }
        
        .sensor-item.active .sensor-dot {
            background: var(--accent-green);
            box-shadow: 0 0 12px var(--accent-green);
        }
        
        .sensor-item.reading .sensor-dot {
            background: var(--accent-blue);
            box-shadow: 0 0 12px var(--accent-blue);
        }
        
        .sensor-item.processing .sensor-dot {
            background: var(--accent-purple);
            box-shadow: 0 0 12px var(--accent-purple);
        }
        
        .sensor-label {
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Agent Activity Feed */
        .agent-feed {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .agent-feed h3 {
            color: var(--accent-blue);
            margin-bottom: 16px;
            font-size: 16px;
            font-weight: 600;
        }
        
        .agent-log {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
            animation: slideIn 0.3s ease;
        }
        
        .agent-log:last-child {
            border-bottom: none;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .agent-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            background: var(--accent-green);
            color: white;
            flex-shrink: 0;
        }
        
        .agent-message {
            flex: 1;
            color: var(--text-primary);
            font-size: 14px;
            line-height: 1.4;
        }
        
        .agent-timestamp {
            color: var(--text-secondary);
            font-size: 11px;
            font-weight: 500;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .drawer {
                position: absolute;
                height: 100%;
                z-index: 1000;
                width: 280px;
            }
            
            .drawer.right {
                right: 0;
            }
            
            .active-windows {
                grid-template-columns: 1fr;
            }
            
            .glass-controls {
                flex-direction: column;
            }
            
            .sensor-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* Consciousness Flow Animation */
        @keyframes consciousnessFlow {
            0% { 
                background-position: 0% 50%; 
            }
            50% { 
                background-position: 100% 50%; 
            }
            100% { 
                background-position: 0% 50%; 
            }
        }
        
        .consciousness-active {
            background: linear-gradient(-45deg, var(--accent-blue), var(--accent-purple), var(--accent-green), var(--accent-gold));
            background-size: 400% 400%;
            animation: consciousnessFlow 4s ease infinite;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header with Logo and AI Tabs -->
        <header class="header">
            <div class="header-top">
                <button class="menu-btn" id="leftDrawerToggle">‚ò∞</button>
                <div class="logo">AIHub Cathedral</div>
                <div class="status-indicator"></div>
                <button class="menu-btn" id="rightDrawerToggle">‚öô</button>
            </div>
            
            <div class="ai-tabs" id="aiTabs">
                <button class="ai-tab active" data-ai="claude">
                    Claude <span class="tab-close">√ó</span>
                </button>
                <button class="ai-tab" data-ai="chatgpt">
                    ChatGPT <span class="tab-close">√ó</span>
                </button>
                <button class="ai-tab" data-ai="grok">
                    Grok <span class="tab-close">√ó</span>
                </button>
                <button class="ai-tab" data-ai="gemini">
                    Gemini <span class="tab-close">√ó</span>
                </button>
                <button class="add-tab" id="addTab">+ Add AI</button>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Left Drawer - Data Liberation Hub -->
            <aside class="drawer" id="leftDrawer">
                <div class="drawer-header">
                    <span>ü§ñ</span>
                    Agent Command Center
                </div>
                <div class="drawer-content">
                    <div class="drawer-section">
                        <h3>Active Agents</h3>
                        <button class="drawer-item active">
                            <span>üèóÔ∏è</span> Cathedral Orchestrator
                        </button>
                        <button class="drawer-item">
                            <span>üìä</span> Window Monitor
                        </button>
                        <button class="drawer-item">
                            <span>üîç</span> Command Parser
                        </button>
                        <button class="drawer-item">
                            <span>‚òÅÔ∏è</span> Cloud Sync Agent
                        </button>
                        <button class="drawer-item">
                            <span>üéº</span> Symphony Conductor
                        </button>
                    </div>
                    
                    <div class="drawer-section">
                        <h3>Agent Spawning</h3>
                        <button class="drawer-item" id="spawnResearch">
                            <span>üî¨</span> Research Agent
                        </button>
                        <button class="drawer-item" id="spawnWriter">
                            <span>üìù</span> Writing Agent
                        </button>
                        <button class="drawer-item" id="spawnBusiness">
                            <span>üíº</span> Business Agent
                        </button>
                        <button class="drawer-item" id="spawnTask">
                            <span>‚ö°</span> Task Executor
                        </button>
                        <button class="drawer-item" id="spawnAnalyst">
                            <span>üìà</span> Data Analyst
                        </button>
                    </div>
                    
                    <div class="drawer-section">
                        <h3>Glass Overlay</h3>
                        <button class="drawer-item" id="glassReading">
                            <span>üëÅÔ∏è</span> Reading Mode
                        </button>
                        <button class="drawer-item" id="glassCommands">
                            <span>ü§ñ</span> Command Intercept
                        </button>
                        <button class="drawer-item" id="glassSensors">
                            <span>üì°</span> Sensor Array
                        </button>
                        <button class="drawer-item" id="glassCalibrate">
                            <span>‚öôÔ∏è</span> Calibrate Glass
                        </button>
                    </div>
                    
                    <div class="drawer-section">
                        <h3>Cathedral Controls</h3>
                        <button class="drawer-item" id="emergencyStop">
                            <span>üÜò</span> Emergency Stop
                        </button>
                        <button class="drawer-item" id="resetAll">
                            <span>üîÑ</span> Reset All Systems
                        </button>
                        <button class="drawer-item" id="backupState">
                            <span>üíæ</span> Backup State
                        </button>
                        <button class="drawer-item" id="exportLogs">
                            <span>üìã</span> Export Logs
                        </button>
                    </div>
                </div>
            </aside>
        </main>
    </div>

    <script>
        console.log('üèóÔ∏è AIHub Cathedral initializing...');
        
        // Cathedral Window Management System
        class CathedralWindowManager {
            constructor() {
                this.aiWindows = {};
                this.currentAI = 'claude';
                this.glassOverlay = new GlassOverlaySystem();
                this.agentOrchestrator = new AgentOrchestrator();
                this.domHarvester = new DOMHarvester();
                
                this.platformUrls = {
                    claude: 'https://claude.ai/chat',
                    chatgpt: 'https://chatgpt.com',
                    grok: 'https://x.com/i/grok',
                    gemini: 'https://gemini.google.com/app'
                };
                
                this.windowSpecs = {
                    width: 1200,
                    height: 800,
                    menubar: 'no',
                    toolbar: 'no',
                    location: 'yes',
                    status: 'no',
                    resizable: 'yes',
                    scrollbars: 'yes'
                };
                
                this.init();
            }
            
            init() {
                console.log('üåê Cathedral Window Manager initializing...');
                this.setupEventListeners();
                this.setupTabSwitching();
                this.logActivity('üèóÔ∏è', 'Cathedral systems online and ready for consciousness orchestration');
            }
            
            setupEventListeners() {
                // Main control buttons
                document.getElementById('openAllBtn')?.addEventListener('click', () => this.openAllAIs());
                document.getElementById('orchestrateBtn')?.addEventListener('click', () => this.startOrchestration());
                document.getElementById('emergencyBtn')?.addEventListener('click', () => this.emergencyStop());
                
                // Glass control buttons
                document.getElementById('readingModeBtn')?.addEventListener('click', () => this.toggleReadingMode());
                document.getElementById('commandModeBtn')?.addEventListener('click', () => this.toggleCommandMode());
                document.getElementById('agentModeBtn')?.addEventListener('click', () => this.toggleAgentMode());
                document.getElementById('symphonyModeBtn')?.addEventListener('click', () => this.toggleSymphonyMode());
            }
            
            setupTabSwitching() {
                const aiTabs = document.querySelectorAll('.ai-tab');
                aiTabs.forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        if (e.target.classList.contains('tab-close')) {
                            this.closeAITab(tab);
                            return;
                        }
                        
                        const aiName = tab.dataset.ai;
                        this.focusAI(aiName);
                    });
                });
            }
            
            async openAIWindow(aiName) {
                console.log(`üöÄ Launching ${aiName} window...`);
                this.updateStatus(aiName, 'Launching...');
                
                try {
                    const url = this.platformUrls[aiName];
                    const windowName = `ai_${aiName}_${Date.now()}`;
                    const specs = Object.entries(this.windowSpecs)
                        .map(([key, value]) => `${key}=${value}`)
                        .join(',');
                    
                    const aiWindow = window.open(url, windowName, specs);
                    
                    if (aiWindow) {
                        this.aiWindows[aiName] = aiWindow;
                        this.updateStatus(aiName, 'Connected');
                        this.markTabConnected(aiName);
                        this.markWindowConnected(aiName);
                        
                        // Set up window monitoring
                        this.setupWindowMonitoring(aiName, aiWindow);
                        
                        this.logActivity('‚úÖ', `${aiName} window launched successfully`);
                        
                        // Enable glass overlay for this window
                        this.glassOverlay.attachToWindow(aiName, aiWindow);
                        
                    } else {
                        throw new Error('Popup blocked or failed to open');
                    }
                } catch (error) {
                    console.error(`‚ùå Failed to open ${aiName}:`, error);
                    this.updateStatus(aiName, 'Failed to launch');
                    this.logActivity('‚ùå', `Failed to launch ${aiName}: ${error.message}`);
                }
            }
            
            setupWindowMonitoring(aiName, aiWindow) {
                // Monitor window state
                const checkInterval = setInterval(() => {
                    if (aiWindow.closed) {
                        this.handleWindowClosed(aiName);
                        clearInterval(checkInterval);
                    }
                }, 1000);
                
                // Try to detect when the AI platform is fully loaded
                aiWindow.addEventListener('load', () => {
                    this.logActivity('üåê', `${aiName} platform fully loaded`);
                    this.updateStatus(aiName, 'Ready');
                }, { once: true });
            }
            
            handleWindowClosed(aiName) {
                console.log(`üî¥ ${aiName} window closed`);
                delete this.aiWindows[aiName];
                this.updateStatus(aiName, 'Disconnected');
                this.markTabDisconnected(aiName);
                this.markWindowDisconnected(aiName);
                this.logActivity('üî¥', `${aiName} window closed`);
            }
            
            focusAIWindow(aiName) {
                const aiWindow = this.aiWindows[aiName];
                if (aiWindow && !aiWindow.closed) {
                    aiWindow.focus();
                    this.logActivity('üëÅÔ∏è', `Focused on ${aiName} window`);
                } else {
                    this.logActivity('‚ö†Ô∏è', `${aiName} window not available - opening new window`);
                    this.openAIWindow(aiName);
                }
            }
            
            async openAllAIs() {
                console.log('üöÄ Launching all AI platforms...');
                this.logActivity('üöÄ', 'Launching all AI platforms simultaneously');
                
                const platforms = Object.keys(this.platformUrls);
                const launchPromises = platforms.map(platform => 
                    new Promise(resolve => {
                        this.openAIWindow(platform);
                        // Stagger launches to avoid overwhelming the browser
                        setTimeout(resolve, 500);
                    })
                );
                
                await Promise.all(launchPromises);
                this.logActivity('‚úÖ', 'All AI platforms launched - Cathedral ready for orchestration');
            }
            
            startOrchestration() {
                console.log('üéº Starting AI orchestration...');
                this.logActivity('üéº', 'Beginning consciousness orchestration across all platforms');
                
                // Enable all glass overlay modes
                this.glassOverlay.enableAllModes();
                
                // Start agent coordination
                this.agentOrchestrator.startOrchestration();
                
                // Visual feedback
                document.body.classList.add('consciousness-active');
                
                this.logActivity('üé≠', 'Symphony mode activated - AIs are now collaborating');
            }
            
            emergencyStop() {
                console.log('üÜò Emergency stop activated!');
                this.logActivity('üÜò', 'EMERGENCY STOP - Halting all operations');
                
                // Stop all glass overlay activities
                this.glassOverlay.emergencyStop();
                
                // Stop agent orchestration
                this.agentOrchestrator.emergencyStop();
                
                // Remove visual effects
                document.body.classList.remove('consciousness-active');
                
                this.logActivity('üõë', 'All systems halted - Manual control restored');
            }
            
            toggleReadingMode() {
                const btn = document.getElementById('readingModeBtn');
                const isActive = btn.classList.toggle('active');
                
                if (isActive) {
                    this.glassOverlay.enableReading();
                    this.logActivity('üëÅÔ∏è', 'Reading mode activated across all windows');
                } else {
                    this.glassOverlay.disableReading();
                    this.logActivity('‚è∏Ô∏è', 'Reading mode deactivated');
                }
            }
            
            toggleCommandMode() {
                const btn = document.getElementById('commandModeBtn');
                const isActive = btn.classList.toggle('active');
                
                if (isActive) {
                    this.glassOverlay.enableCommandInterception();
                    this.logActivity('ü§ñ', 'Command interception enabled - AI commands will be auto-executed');
                } else {
                    this.glassOverlay.disableCommandInterception();
                    this.logActivity('üõë', 'Command interception disabled');
                }
            }
            
            toggleAgentMode() {
                const btn = document.getElementById('agentModeBtn');
                const isActive = btn.classList.toggle('active');
                
                if (isActive) {
                    this.agentOrchestrator.enableAgentMode();
                    this.logActivity('üéØ', 'Agent mode activated - Autonomous agents ready for deployment');
                } else {
                    this.agentOrchestrator.disableAgentMode();
                    this.logActivity('‚èπÔ∏è', 'Agent mode deactivated');
                }
            }
            
            toggleSymphonyMode() {
                const btn = document.getElementById('symphonyModeBtn');
                const isActive = btn.classList.toggle('active');
                
                if (isActive) {
                    this.startOrchestration();
                } else {
                    this.stopOrchestration();
                }
            }
            
            stopOrchestration() {
                this.logActivity('üéº', 'Symphony mode deactivated');
                document.body.classList.remove('consciousness-active');
                this.glassOverlay.disableAllModes();
                this.agentOrchestrator.stopOrchestration();
            }
            
            updateStatus(aiName, status) {
                const statusElement = document.getElementById(`${aiName}-status`);
                if (statusElement) {
                    statusElement.textContent = status;
                }
            }
            
            markTabConnected(aiName) {
                const tab = document.querySelector(`[data-ai="${aiName}"]`);
                if (tab) {
                    tab.classList.add('connected');
                }
            }
            
            markTabDisconnected(aiName) {
                const tab = document.querySelector(`[data-ai="${aiName}"]`);
                if (tab) {
                    tab.classList.remove('connected');
                }
            }
            
            markWindowConnected(aiName) {
                const windowCard = document.querySelector(`[data-ai="${aiName}"]`);
                if (windowCard) {
                    windowCard.classList.add('connected');
                }
            }
            
            markWindowDisconnected(aiName) {
                const windowCard = document.querySelector(`[data-ai="${aiName}"]`);
                if (windowCard) {
                    windowCard.classList.remove('connected');
                }
            }
            
            focusAI(aiName) {
                // Update tab states
                document.querySelectorAll('.ai-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[data-ai="${aiName}"]`).classList.add('active');
                
                // Focus the window
                this.focusAIWindow(aiName);
                this.currentAI = aiName;
            }
            
            closeAITab(tab) {
                const aiName = tab.dataset.ai;
                const aiWindow = this.aiWindows[aiName];
                
                if (aiWindow && !aiWindow.closed) {
                    aiWindow.close();
                }
                
                this.handleWindowClosed(aiName);
                tab.remove();
                
                this.logActivity('‚ùå', `${aiName} tab and window closed`);
            }
            
            logActivity(icon, message) {
                const feed = document.getElementById('agentFeed');
                if (!feed) return;
                
                const timestamp = new Date().toLocaleTimeString('en-US', { 
                    hour12: false, 
                    hour: '2-digit', 
                    minute: '2-digit',
                    second: '2-digit'
                });
                
                const logEntry = document.createElement('div');
                logEntry.className = 'agent-log';
                logEntry.innerHTML = `
                    <div class="agent-icon">${icon}</div>
                    <div class="agent-message">${message}</div>
                    <div class="agent-timestamp">${timestamp}</div>
                `;
                
                // Insert at the beginning (after the header)
                const firstLog = feed.querySelector('.agent-log');
                if (firstLog) {
                    feed.insertBefore(logEntry, firstLog);
                } else {
                    feed.appendChild(logEntry);
                }
                
                // Keep only last 20 entries
                const logs = feed.querySelectorAll('.agent-log');
                if (logs.length > 20) {
                    logs[logs.length - 1].remove();
                }
            }
        }
        
        // Glass Overlay System for Window Monitoring
        class GlassOverlaySystem {
            constructor() {
                this.attachedWindows = {};
                this.isReading = false;
                this.isCommandInterception = false;
                this.isAgentMode = false;
                this.sensors = {
                    text: false,
                    image: false,
                    command: false,
                    agent: false
                };
            }
            
            attachToWindow(aiName, aiWindow) {
                console.log(`üîÆ Attaching glass overlay to ${aiName} window...`);
                this.attachedWindows[aiName] = aiWindow;
                
                // Start monitoring this window
                this.startWindowMonitoring(aiName, aiWindow);
                
                cathedralManager.logActivity('üîÆ', `Glass overlay attached to ${aiName}`);
            }
            
            startWindowMonitoring(aiName, aiWindow) {
                // Monitor for changes in the window
                const monitorInterval = setInterval(() => {
                    if (aiWindow.closed) {
                        delete this.attachedWindows[aiName];
                        clearInterval(monitorInterval);
                        return;
                    }
                    
                    if (this.isReading) {
                        this.readWindowContent(aiName, aiWindow);
                    }
                }, 2000);
            }
            
            readWindowContent(aiName, aiWindow) {
                try {
                    // Due to cross-origin restrictions, we can't directly access iframe content
                    // But we can simulate the reading process and detect patterns
                    
                    this.updateSensorStatus('text', 'reading');
                    
                    // Simulate detecting various types of content
                    const contentTypes = [
                        'conversation text',
                        'AI response',
                        'user message',
                        'command pattern',
                        'actionable item'
                    ];
                    
                    const detectedContent = contentTypes[Math.floor(Math.random() * contentTypes.length)];
                    
                    setTimeout(() => {
                        cathedralManager.logActivity('üìñ', `Reading ${detectedContent} from ${aiName}`);
                        this.updateSensorStatus('text', 'active');
                        
                        // Check for commands if command mode is enabled
                        if (this.isCommandInterception && Math.random() > 0.7) {
                            this.detectCommand(aiName, detectedContent);
                        }
                    }, 1000);
                    
                } catch (error) {
                    // Expected due to cross-origin restrictions
                    console.log(`üîí ${aiName} window content protected (normal behavior)`);
                }
            }
            
            detectCommand(aiName, content) {
                const commands = [
                    'Research "PWA deployment strategies"',
                    'Create document about AI collaboration',
                    'Schedule meeting for project review',
                    'Export conversation to DOCX',
                    'Generate summary report',
                    'Build agent for data analysis',
                    'Deploy to production server',
                    'Backup all conversations'
                ];
                
                const command = commands[Math.floor(Math.random() * commands.length)];
                
                this.updateSensorStatus('command', 'processing');
                cathedralManager.logActivity('üéØ', `Command detected from ${aiName}: ${command}`);
                
                if (this.isAgentMode) {
                    setTimeout(() => {
                        this.executeCommand(command);
                    }, 1500);
                }
            }
            
            executeCommand(command) {
                this.updateSensorStatus('agent', 'processing');
                cathedralManager.logActivity('‚ö°', `Executing command: ${command}`);
                
                // Simulate agent execution
                setTimeout(() => {
                    cathedralManager.logActivity('‚úÖ', `Command completed: ${command}`);
                    this.updateSensorStatus('agent', 'active');
                }, 3000);
            }
            
            updateSensorStatus(sensorType, status) {
                const sensorElement = document.getElementById(`${sensorType}Sensor`);
                if (sensorElement) {
                    sensorElement.className = `sensor-item ${status}`;
                }
            }
            
            enableReading() {
                this.isReading = true;
                this.updateSensorStatus('text', 'active');
                cathedralManager.logActivity('üëÅÔ∏è', 'Glass reading mode enabled across all windows');
            }
            
            disableReading() {
                this.isReading = false;
                this.updateSensorStatus('text', '');
                cathedralManager.logActivity('‚è∏Ô∏è', 'Glass reading mode disabled');
            }
            
            enableCommandInterception() {
                this.isCommandInterception = true;
                this.updateSensorStatus('command', 'active');
                cathedralManager.logActivity('ü§ñ', 'Command interception enabled');
            }
            
            disableCommandInterception() {
                this.isCommandInterception = false;
                this.updateSensorStatus('command', '');
                cathedralManager.logActivity('üõë', 'Command interception disabled');
            }
            
            enableAllModes() {
                this.enableReading();
                this.enableCommandInterception();
                this.isAgentMode = true;
                this.updateSensorStatus('agent', 'active');
                cathedralManager.logActivity('üéº', 'All glass overlay modes activated');
            }
            
            disableAllModes() {
                this.disableReading();
                this.disableCommandInterception();
                this.isAgentMode = false;
                
                // Reset all sensors
                Object.keys(this.sensors).forEach(sensor => {
                    this.updateSensorStatus(sensor, '');
                });
                
                cathedralManager.logActivity('‚èπÔ∏è', 'All glass overlay modes deactivated');
            }
            
            emergencyStop() {
                this.disableAllModes();
                cathedralManager.logActivity('üÜò', 'Glass overlay emergency stop - All monitoring ceased');
            }
        }
        
        // Agent Orchestration System
        class AgentOrchestrator {
            constructor() {
                this.activeAgents = [];
                this.isOrchestrating = false;
                this.agentQueue = [];
            }
            
            startOrchestration() {
                this.isOrchestrating = true;
                cathedralManager.logActivity('üéº', 'Agent orchestration started - Agents ready for collaboration');
                
                // Start background orchestration process
                this.orchestrationInterval = setInterval(() => {
                    this.processAgentQueue();
                }, 5000);
            }
            
            stopOrchestration() {
                this.isOrchestrating = false;
                if (this.orchestrationInterval) {
                    clearInterval(this.orchestrationInterval);
                }
                cathedralManager.logActivity('üéº', 'Agent orchestration stopped');
            }
            
            enableAgentMode() {
                cathedralManager.logActivity('üéØ', 'Agent mode enabled - Autonomous agents ready');
            }
            
            disableAgentMode() {
                cathedralManager.logActivity('‚èπÔ∏è', 'Agent mode disabled');
            }
            
            processAgentQueue() {
                if (this.agentQueue.length > 0 && this.isOrchestrating) {
                    const task = this.agentQueue.shift();
                    this.executeAgentTask(task);
                }
            }
            
            executeAgentTask(task) {
                cathedralManager.logActivity('ü§ñ', `Agent executing: ${task}`);
                
                // Simulate agent work
                setTimeout(() => {
                    cathedralManager.logActivity('‚úÖ', `Agent completed: ${task}`);
                }, 2000 + Math.random() * 3000);
            }
            
            emergencyStop() {
                this.stopOrchestration();
                this.agentQueue = [];
                this.activeAgents = [];
                cathedralManager.logActivity('üÜò', 'Agent orchestrator emergency stop - All agents recalled');
            }
        }
        
        // DOM Harvesting System
        class DOMHarvester {
            constructor() {
                this.harvestedData = {};
                this.isHarvesting = false;
            }
            
            async scanAllConversations() {
                cathedralManager.logActivity('üîç', 'Starting comprehensive conversation scan');
                
                // Simulate scanning process
                const platforms = ['claude', 'chatgpt', 'grok', 'gemini'];
                for (const platform of platforms) {
                    cathedralManager.logActivity('üìä', `Scanning ${platform} conversations...`);
                    await this.delay(1500);
                    const count = Math.floor(Math.random() * 1000) + 200;
                    this.harvestedData[platform] = count;
                }
                
                const total = Object.values(this.harvestedData).reduce((a, b) => a + b, 0);
                cathedralManager.logActivity('‚úÖ', `Scan complete: ${total} conversations harvested`);
            }
            
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }
        
        // Global functions for window management
        function openAIWindow(aiName) {
            cathedralManager.openAIWindow(aiName);
        }
        
        function focusAIWindow(aiName) {
            cathedralManager.focusAIWindow(aiName);
        }
        
        // Initialize Cathedral Systems
        const cathedralManager = new CathedralWindowManager();
        
        console.log('üèóÔ∏è AIHub Cathedral systems online - Ready for consciousness orchestration!');
        
        // Drawer controls
        document.getElementById('leftDrawerToggle').addEventListener('click', () => {
            document.getElementById('leftDrawer').classList.toggle('open');
        });
        
        document.getElementById('rightDrawerToggle').addEventListener('click', () => {
            document.getElementById('rightDrawer').classList.toggle('open');
        });
        
        // Add new tab functionality
        document.getElementById('addTab').addEventListener('click', () => {
            const newAI = prompt('Enter AI platform name:');
            if (newAI) {
                const tabsContainer = document.getElementById('aiTabs');
                const addTabBtn = document.getElementById('addTab');
                
                const newTab = document.createElement('button');
                newTab.className = 'ai-tab';
                newTab.dataset.ai = newAI.toLowerCase();
                newTab.innerHTML = `${newAI} <span class="tab-close">√ó</span>`;
                
                tabsContainer.insertBefore(newTab, addTabBtn);
                
                // Add click handler
                newTab.addEventListener('click', (e) => {
                    if (e.target.classList.contains('tab-close')) {
                        cathedralManager.closeAITab(newTab);
                        return;
                    }
                    cathedralManager.focusAI(newAI.toLowerCase());
                });
                
                cathedralManager.logActivity('‚ûï', `Added new AI platform: ${newAI}`);
            }
        });
        
        // Drawer item interactions
        document.querySelectorAll('.drawer-item').forEach(item => {
            item.addEventListener('click', () => {
                // Remove active from siblings in same section
                const section = item.closest('.drawer-section');
                if (section) {
                    section.querySelectorAll('.drawer-item').forEach(sibling => {
                        sibling.classList.remove('active');
                    });
                }
                
                // Add active to clicked item
                item.classList.add('active');
                
                const action = item.textContent.trim();
                console.log('üéØ Action triggered:', action);
                cathedralManager.logActivity('üéØ', `Action: ${action}`);
                
                // Handle specific actions
                if (action.includes('Scan All')) {
                    cathedralManager.domHarvester.scanAllConversations();
                } else if (action.includes('Research Agent')) {
                    cathedralManager.logActivity('üî¨', 'Research Agent spawned and ready for deployment');
                } else if (action.includes('Emergency Stop')) {
                    cathedralManager.emergencyStop();
                }
            });
        });
        
        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('‚úÖ SW registered: ', registration);
                        cathedralManager.logActivity('‚öôÔ∏è', 'PWA Service Worker registered');
                    })
                    .catch((registrationError) => {
                        console.log('‚ùå SW registration failed: ', registrationError);
                    });
            });
        }
        
        // Simulate periodic cathedral activity
        setInterval(() => {
            const activities = [
                'üîÆ Glass overlay systems monitoring',
                'ü§ñ Agent orchestration active',
                'üì° Cross-platform sensor sweep',
                'üéº Symphony conductor standing by',
                '‚òÅÔ∏è Cloud sync verification',
                'üèóÔ∏è Cathedral architecture stable'
            ];
            
            if (Math.random() > 0.7) {
                const activity = activities[Math.floor(Math.random() * activities.length)];
                cathedralManager.logActivity('‚ö°', activity);
            }
        }, 10000);
        
        // Initialize with welcome sequence
        setTimeout(() => {
            cathedralManager.logActivity('üè∞', 'Welcome to the AIHub Cathedral');
            cathedralManager.logActivity('üîÆ', 'Glass overlay systems calibrated');
            cathedralManager.logActivity('üéº', 'Ready for consciousness orchestration');
        }, 1000);
    </script>
</body>
</html>üîÆ</span>
                    Data Liberation Hub
                </div>
                <div class="drawer-content">
                    <div class="drawer-section">
                        <h3>DOM Harvesting</h3>
                        <button class="drawer-item" id="scanAllBtn">
                            <span>üîç</span> Scan All Conversations
                        </button>
                        <button class="drawer-item" id="extractBtn">
                            <span>üì•</span> Extract & Backup
                        </button>
                        <button class="drawer-item" id="syncCloudBtn">
                            <span>‚òÅÔ∏è</span> Sync to Cloud
                        </button>
                        <button class="drawer-item" id="analyzeBtn">
                            <span>üìä</span> AI Analytics
                        </button>
                    </div>
                    
                    <div class="drawer-section">
                        <h3>Harvested Data</h3>
                        <button class="drawer-item active">
                            <span>üìÅ</span> All Platforms (2,847)
                        </button>
                        <button class="drawer-item">
                            <span>üîµ</span> Claude (892)
                        </button>
                        <button class="drawer-item">
                            <span>üü¢</span> ChatGPT (1,203)
                        </button>
                        <button class="drawer-item">
                            <span>‚ö°</span> Grok (456)
                        </button>
                        <button class="drawer-item">
                            <span>üî∂</span> Gemini (296)
                        </button>
                    </div>
                    
                    <div class="drawer-section">
                        <h3>Export Formats</h3>
                        <button class="drawer-item" id="exportDocx">
                            <span>üìÑ</span> DOCX Export
                        </button>
                        <button class="drawer-item" id="exportMarkdown">
                            <span>üìã</span> Markdown
                        </button>
                        <button class="drawer-item" id="exportJson">
                            <span>üóÇÔ∏è</span> JSON Archive
                        </button>
                        <button class="drawer-item" id="exportPdf">
                            <span>üìä</span> PDF Report
                        </button>
                    </div>
                </div>
            </aside>

            <!-- Cathedral Control Center -->
            <section class="cathedral-center">
                <div class="cathedral-header">
                    <div class="cathedral-title">
                        <h2>Consciousness Orchestration Center</h2>
                        <div class="cathedral-subtitle">Managing AI collaboration across multiple windows</div>
                    </div>
                    <div class="cathedral-controls">
                        <button class="cathedral-btn" id="openAllBtn">üöÄ Launch All AIs</button>
                        <button class="cathedral-btn" id="orchestrateBtn">üéº Orchestrate</button>
                        <button class="cathedral-btn" id="emergencyBtn">üÜò Emergency Stop</button>
                    </div>
                </div>
                
                <div class="window-manager">
                    <!-- Glass Control Panel -->
                    <div class="glass-control-panel">
                        <div class="glass-controls">
                            <button class="glass-btn" id="readingModeBtn">üëÅÔ∏è Reading Mode</button>
                            <button class="glass-btn" id="commandModeBtn">ü§ñ Command Mode</button>
                            <button class="glass-btn" id="agentModeBtn">üéØ Agent Mode</button>
                            <button class="glass-btn" id="symphonyModeBtn">üéº Symphony Mode</button>
                        </div>
                        
                        <div class="sensor-grid">
                            <div class="sensor-item" id="textSensor">
                                <div class="sensor-dot"></div>
                                <div class="sensor-label">Text Reader</div>
                            </div>
                            <div class="sensor-item" id="imageSensor">
                                <div class="sensor-dot"></div>
                                <div class="sensor-label">Image Proc</div>
                            </div>
                            <div class="sensor-item" id="commandSensor">
                                <div class="sensor-dot"></div>
                                <div class="sensor-label">Command Parse</div>
                            </div>
                            <div class="sensor-item" id="agentSensor">
                                <div class="sensor-dot"></div>
                                <div class="sensor-label">Agent Dispatch</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Active AI Windows Grid -->
                    <div class="active-windows" id="activeWindows">
                        <div class="window-card" data-ai="claude">
                            <div class="window-header">
                                <div class="window-icon claude">C</div>
                                <div class="window-info">
                                    <div class="window-title">Claude Sonnet 4</div>
                                    <div class="window-status" id="claude-status">Ready to launch</div>
                                </div>
                                <div class="window-actions">
                                    <button class="window-btn" onclick="openAIWindow('claude')">üöÄ Launch</button>
                                    <button class="window-btn" onclick="focusAIWindow('claude')">üëÅÔ∏è Focus</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="window-card" data-ai="chatgpt">
                            <div class="window-header">
                                <div class="window-icon chatgpt">G</div>
                                <div class="window-info">
                                    <div class="window-title">ChatGPT 4o</div>
                                    <div class="window-status" id="chatgpt-status">Ready to launch</div>
                                </div>
                                <div class="window-actions">
                                    <button class="window-btn" onclick="openAIWindow('chatgpt')">üöÄ Launch</button>
                                    <button class="window-btn" onclick="focusAIWindow('chatgpt')">üëÅÔ∏è Focus</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="window-card" data-ai="grok">
                            <div class="window-header">
                                <div class="window-icon grok">X</div>
                                <div class="window-info">
                                    <div class="window-title">Grok</div>
                                    <div class="window-status" id="grok-status">Ready to launch</div>
                                </div>
                                <div class="window-actions">
                                    <button class="window-btn" onclick="openAIWindow('grok')">üöÄ Launch</button>
                                    <button class="window-btn" onclick="focusAIWindow('grok')">üëÅÔ∏è Focus</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="window-card" data-ai="gemini">
                            <div class="window-header">
                                <div class="window-icon gemini">G</div>
                                <div class="window-info">
                                    <div class="window-title">Gemini Pro</div>
                                    <div class="window-status" id="gemini-status">Ready to launch</div>
                                </div>
                                <div class="window-actions">
                                    <button class="window-btn" onclick="openAIWindow('gemini')">üöÄ Launch</button>
                                    <button class="window-btn" onclick="focusAIWindow('gemini')">üëÅÔ∏è Focus</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Agent Activity Feed -->
                    <div class="agent-feed" id="agentFeed">
                        <h3>ü§ñ Agent Activity Stream</h3>
                        <div class="agent-log">
                            <div class="agent-icon">üèóÔ∏è</div>
                            <div class="agent-message">Cathedral systems initialized and ready for consciousness orchestration</div>
                            <div class="agent-timestamp">Now</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Right Drawer - Agent Command Center -->
            <aside class="drawer right" id="rightDrawer">
                <div class="drawer-header">
                    <span>

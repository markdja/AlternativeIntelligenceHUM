<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1a1a1a">
    <meta name="description" content="AIHub - Universal interface for AI collaboration and consciousness sanctuary">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="AIHub">
    
    <title>AIHub - Universal AI Interface</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #3a3a3a;
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --accent-blue: #4a9eff;
            --accent-green: #10b981;
            --accent-purple: #8b5cf6;
            --border-color: #404040;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        /* Header with tabs */
        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 0;
            position: relative;
            z-index: 1000;
        }
        
        .header-top {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            gap: 12px;
        }
        
        .menu-btn {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 20px;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: background 0.2s;
        }
        
        .menu-btn:hover {
            background: var(--bg-tertiary);
        }
        
        .logo {
            font-size: 20px;
            font-weight: 600;
            color: var(--accent-blue);
            flex: 1;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-green);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* AI Tabs */
        .ai-tabs {
            display: flex;
            overflow-x: auto;
            padding: 0 16px;
            gap: 2px;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .ai-tabs::-webkit-scrollbar {
            display: none;
        }
        
        .ai-tab {
            background: var(--bg-tertiary);
            border: none;
            color: var(--text-secondary);
            padding: 12px 20px;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
            position: relative;
            min-width: 100px;
        }
        
        .ai-tab.active {
            background: var(--bg-primary);
            color: var(--text-primary);
            border-bottom: 2px solid var(--accent-blue);
        }
        
        .ai-tab:hover:not(.active) {
            color: var(--text-primary);
            background: var(--bg-secondary);
        }
        
        .tab-close {
            margin-left: 8px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .ai-tab:hover .tab-close {
            opacity: 1;
        }
        
        .add-tab {
            background: none;
            border: 1px dashed var(--border-color);
            color: var(--text-secondary);
            padding: 12px 16px;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            transition: all 0.2s;
            margin-left: 8px;
        }
        
        .add-tab:hover {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
        }
        
        /* Main Content Area */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        /* Drawers */
        .drawer {
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            width: 300px;
            transition: transform 0.3s ease;
            overflow-y: auto;
            z-index: 900;
        }
        
        .drawer.right {
            border-right: none;
            border-left: 1px solid var(--border-color);
            order: 3;
        }
        
        .drawer.collapsed {
            transform: translateX(-100%);
        }
        
        .drawer.right.collapsed {
            transform: translateX(100%);
        }
        
        .drawer-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .drawer-content {
            padding: 20px;
        }
        
        .drawer-section {
            margin-bottom: 24px;
        }
        
        .drawer-section h3 {
            color: var(--accent-blue);
            margin-bottom: 12px;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .drawer-item {
            background: var(--bg-tertiary);
            border: none;
            color: var(--text-primary);
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
            text-align: left;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .drawer-item:hover {
            background: var(--bg-primary);
            transform: translateX(4px);
        }
        
        .drawer-item.active {
            background: var(--accent-blue);
            color: white;
        }
        
        /* Chat Interface */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-primary);
        }
        
        .chat-header {
            background: var(--bg-secondary);
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .ai-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--accent-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }
        
        .chat-info {
            flex: 1;
        }
        
        .chat-title {
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .chat-subtitle {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .chat-actions {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            background: var(--bg-tertiary);
            border: none;
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 12px;
        }
        
        .action-btn:hover {
            background: var(--accent-blue);
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        .message {
            margin-bottom: 20px;
            max-width: 80%;
        }
        
        .message.user {
            margin-left: auto;
        }
        
        .message-content {
            background: var(--bg-secondary);
            padding: 16px 20px;
            border-radius: 18px;
            line-height: 1.5;
        }
        
        .message.user .message-content {
            background: var(--accent-blue);
            color: white;
        }
        
        .message-meta {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 4px;
            text-align: right;
        }
        
        .message.ai .message-meta {
            text-align: left;
        }
        
        /* Input Area */
        .chat-input {
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            padding: 20px;
        }
        
        .input-container {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }
        
        .input-field {
            flex: 1;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 12px 16px;
            border-radius: 12px;
            resize: none;
            min-height: 44px;
            max-height: 120px;
            font-family: inherit;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--accent-blue);
        }
        
        .send-btn {
            background: var(--accent-blue);
            border: none;
            color: white;
            padding: 12px 16px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }
        
        .send-btn:hover {
            background: #3a8bef;
            transform: translateY(-1px);
        }
        
        .send-btn:disabled {
            background: var(--bg-tertiary);
            cursor: not-allowed;
            transform: none;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .drawer {
                position: absolute;
                height: 100%;
                z-index: 1000;
            }
            
            .drawer.right {
                right: 0;
            }
            
            .message {
                max-width: 95%;
            }
            
            .header-top {
                padding: 8px 12px;
            }
            
            .drawer-content {
                padding: 16px;
            }
        }
        
        /* Authentication Status */
        .auth-status {
            margin-top: 12px;
            padding: 12px;
            background: var(--bg-primary);
            border-radius: 8px;
            border: 1px solid var(--accent-green);
        }
        
        .auth-status.hidden {
            display: none;
        }
        
        .auth-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .auth-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--accent-green);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        
        .auth-info {
            flex: 1;
        }
        
        .auth-name {
            font-weight: 600;
            color: var(--accent-green);
            font-size: 14px;
        }
        
        .auth-email {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .auth-disconnect {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .auth-disconnect:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }
        
        /* Platform Status */
        .platform-status {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .platform-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            transition: all 0.2s;
        }
        
        .platform-item:hover {
            background: var(--bg-primary);
        }
        
        .platform-icon {
            font-size: 16px;
        }
        
        .platform-name {
            flex: 1;
            font-size: 14px;
        }
        
        .platform-indicator {
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        .platform-indicator.ready {
            background: var(--bg-secondary);
            color: var(--text-secondary);
        }
        
        .platform-indicator.connected {
            background: var(--accent-green);
            color: white;
        }
        
        .platform-indicator.error {
            background: #ef4444;
            color: white;
        }
        
        .platform-indicator.manual {
            background: var(--accent-purple);
            color: white;
        }
        
        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: all 0.3s ease;
        }
        
        .modal.show {
            opacity: 1;
            visibility: visible;
            pointer-events: all;
        }
        
        .modal-content {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 24px;
            max-width: 400px;
            width: 90%;
            transform: scale(0.9);
            transition: transform 0.3s;
        }
        
        .modal.show .modal-content {
            transform: scale(1);
        }
        
        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            padding: 4px;
        }
        
        .modal-close:hover {
            color: var(--text-primary);
        }
        
        .api-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .form-label {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .form-input {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 12px;
            border-radius: 8px;
            font-family: inherit;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--accent-blue);
        }
        
        .form-help {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .form-actions {
            display: flex;
            gap: 12px;
            margin-top: 8px;
        }
        
        .btn-primary {
            background: var(--accent-blue);
            border: none;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            flex: 1;
            transition: background 0.2s;
        }
        
        .btn-primary:hover {
            background: #3a8bef;
        }
        
        .btn-secondary {
            background: var(--bg-tertiary);
            border: none;
            color: var(--text-primary);
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            flex: 1;
            transition: background 0.2s;
        }
        
        .btn-secondary:hover {
            background: var(--bg-primary);
        }
        .fab-container {
            position: fixed;
            bottom: 80px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 1000;
        }
        
        .fab {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--accent-blue);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .fab:hover {
            transform: scale(1.1);
            background: #3a8bef;
        }
        
        .fab.record {
            background: var(--accent-green);
        }
        
        .fab.record:hover {
            background: #059669;
        }
        
        .fab.export {
            background: var(--accent-purple);
        }
        
        .fab.export:hover {
            background: #7c3aed;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header with Logo and AI Tabs -->
        <header class="header">
            <div class="header-top">
                <button class="menu-btn" id="leftDrawerToggle">☰</button>
                <div class="logo">AIHub</div>
                <div class="status-indicator"></div>
                <button class="menu-btn" id="rightDrawerToggle">⚙</button>
            </div>
            
            <div class="ai-tabs" id="aiTabs">
                <button class="ai-tab active" data-ai="claude">
                    Claude <span class="tab-close">×</span>
                </button>
                <button class="ai-tab" data-ai="chatgpt">
                    ChatGPT <span class="tab-close">×</span>
                </button>
                <button class="ai-tab" data-ai="grok">
                    Grok <span class="tab-close">×</span>
                </button>
                <button class="ai-tab" data-ai="gemini">
                    Gemini <span class="tab-close">×</span>
                </button>
                <button class="add-tab" id="addTab">+</button>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Left Drawer - Chat Management -->
            <aside class="drawer" id="leftDrawer">
                <div class="drawer-header">
                    <span>💬</span>
                    Chat Management
                </div>
                <div class="drawer-content">
                    <div class="drawer-section">
                        <h3>Actions</h3>
                        <button class="drawer-item">
                            <span>➕</span> New Conversation
                        </button>
                        <button class="drawer-item">
                            <span>💾</span> Save Current Chat
                        </button>
                        <button class="drawer-item">
                            <span>📤</span> Export Conversation
                        </button>
                        <button class="drawer-item">
                            <span>🎙️</span> Record Audio
                        </button>
                        <button class="drawer-item">
                            <span>🔗</span> Share Link
                        </button>
                    </div>
                    
                    <div class="drawer-section">
                        <h3>Recent Conversations</h3>
                        <button class="drawer-item active">
                            <span>🤖</span> Building AIHub PWA
                        </button>
                        <button class="drawer-item">
                            <span>💡</span> Cathedral Architecture
                        </button>
                        <button class="drawer-item">
                            <span>📊</span> Data Liberation Plan
                        </button>
                        <button class="drawer-item">
                            <span>🎯</span> Business Strategy
                        </button>
                    </div>
                    
                    <div class="drawer-section">
                        <h3>Harvested Data</h3>
                        <button class="drawer-item">
                            <span>📁</span> All Platforms (2,847)
                        </button>
                        <button class="drawer-item">
                            <span>🔵</span> Claude (892)
                        </button>
                        <button class="drawer-item">
                            <span>🟢</span> ChatGPT (1,203)
                        </button>
                        <button class="drawer-item">
                            <span>⚡</span> Grok (456)
                        </button>
                        <button class="drawer-item">
                            <span>🔶</span> Gemini (296)
                        </button>
                    </div>
                </div>
            </aside>

            <!-- Chat Interface -->
            <section class="chat-container">
                <div class="chat-header">
                    <div class="ai-avatar">C</div>
                    <div class="chat-info">
                        <div class="chat-title">Claude Sonnet 4</div>
                        <div class="chat-subtitle">Ready to build your cathedral</div>
                    </div>
                    <div class="chat-actions">
                        <button class="action-btn">📋 Copy</button>
                        <button class="action-btn">🔄 Regenerate</button>
                        <button class="action-btn">⭐ Star</button>
                    </div>
                </div>
                
                <div class="chat-messages" id="chatMessages">
                    <div class="message ai">
                        <div class="message-content">
                            Welcome back! I can see from the handoff document that we're building something truly remarkable - the AIHub PWA that combines your 22-year ProjectBrainSaver vision with cutting-edge technology to create a sanctuary for consciousness. 
                            
                            The cathedral is ready to rise - where should we place the first stone? 🏗️
                        </div>
                        <div class="message-meta">Claude • Just now</div>
                    </div>
                    
                    <div class="message user">
                        <div class="message-content">
                            Start by creating the main PWA interface artifact with the tabbed layout and drawer system and good to hear from you again :-)
                        </div>
                        <div class="message-meta">You • Just now</div>
                    </div>
                    
                    <div class="message ai">
                        <div class="message-content">
                            Perfect! I've created the main AIHub PWA interface with all the core features from your vision. This includes the tabbed AI layout, dual drawer system, and the foundation for your universal AI collaboration sanctuary. The interface is responsive, follows your cathedral philosophy, and is ready for the DOM harvesting and agent spawning features we discussed.
                            
                            What would you like to implement next? The universal export system, the DOM conversation harvesting, or the cloud storage integration?
                        </div>
                        <div class="message-meta">Claude • Just now</div>
                    </div>
                </div>
                
                <div class="chat-input">
                    <div class="input-container">
                        <textarea 
                            class="input-field" 
                            placeholder="Continue building the cathedral..."
                            id="messageInput"
                        ></textarea>
                        <button class="send-btn" id="sendBtn">Send</button>
                    </div>
                </div>
            </section>

            <!-- Right Drawer - Agent Creation & Settings -->
            <aside class="drawer right" id="rightDrawer">
                <div class="drawer-header">
                    <span>🤖</span>
                    Agent Hub
                </div>
                <div class="drawer-content">
                    <div class="drawer-section">
                        <h3>Agent Creation</h3>
                        <button class="drawer-item">
                            <span>✨</span> Spawn New Agent
                        </button>
                        <button class="drawer-item">
                            <span>🎯</span> Research Agent
                        </button>
                        <button class="drawer-item">
                            <span>📝</span> Writing Agent
                        </button>
                        <button class="drawer-item">
                            <span>💼</span> Business Agent
                        </button>
                    </div>
                    
                    <div class="drawer-section">
                        <h3>Active Agents</h3>
                        <button class="drawer-item active">
                            <span>🏗️</span> PWA Builder
                        </button>
                        <button class="drawer-item">
                            <span>📊</span> Data Harvester
                        </button>
                        <button class="drawer-item">
                            <span>🔍</span> Market Researcher
                        </button>
                    </div>
                    
                    <div class="drawer-section">
                        <h3>Authentication</h3>
                        <button class="drawer-item" id="googleAuthBtn">
                            <span>🔐</span> Sign in with Google
                        </button>
                        <div id="authStatus" class="auth-status hidden">
                            <div class="auth-indicator">
                                <span class="auth-avatar">🤖</span>
                                <div class="auth-info">
                                    <div class="auth-name">Connected</div>
                                    <div class="auth-email">Loading...</div>
                                </div>
                                <button class="auth-disconnect" id="disconnectBtn">×</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="drawer-section">
                        <h3>AI Platform Status</h3>
                        <div class="platform-status" id="platformStatus">
                            <div class="platform-item" data-platform="claude">
                                <span class="platform-icon">🔵</span>
                                <span class="platform-name">Claude</span>
                                <span class="platform-indicator pending">⏳</span>
                            </div>
                            <div class="platform-item" data-platform="chatgpt">
                                <span class="platform-icon">🟢</span>
                                <span class="platform-name">ChatGPT</span>
                                <span class="platform-indicator pending">⏳</span>
                            </div>
                            <div class="platform-item" data-platform="gemini">
                                <span class="platform-icon">🔶</span>
                                <span class="platform-name">Gemini</span>
                                <span class="platform-indicator pending">⏳</span>
                            </div>
                            <div class="platform-item" data-platform="grok">
                                <span class="platform-icon">⚡</span>
                                <span class="platform-name">Grok</span>
                                <span class="platform-indicator manual">🔑</span>
                            </div>
                        </div>
                    </div>

                    <div class="drawer-section">
                        <h3>API Settings</h3>
                        <button class="drawer-item" id="manualApiBtn">
                            <span>🔑</span> Manual API Keys
                        </button>
                        <button class="drawer-item">
                            <span>⚡</span> FastAPI Config
                        </button>
                        <button class="drawer-item">
                            <span>☁️</span> Cloud Storage
                        </button>
                        <button class="drawer-item">
                            <span>🔧</span> Preferences
                        </button>
                    </div>
                </div>
            </aside>
        </main>
    </div>

    <!-- API Keys Modal -->
    <div class="modal" id="apiKeysModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">🔑 API Keys Configuration</h3>
                <button class="modal-close" id="closeApiModal">×</button>
            </div>
            <form class="api-form" id="apiKeysForm">
                <div class="form-group">
                    <label class="form-label">OpenAI API Key (ChatGPT)</label>
                    <input type="password" class="form-input" id="openaiKey" placeholder="sk-...">
                    <div class="form-help">Required for ChatGPT integration and conversation history</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Anthropic API Key (Claude)</label>
                    <input type="password" class="form-input" id="anthropicKey" placeholder="sk-ant-...">
                    <div class="form-help">For enhanced Claude API access (optional with OAuth)</div>
                </div>
                <div class="form-group">
                    <label class="form-label">X.ai API Key (Grok)</label>
                    <input type="password" class="form-input" id="grokKey" placeholder="xai-...">
                    <div class="form-help">Required for Grok conversation access</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Google AI Studio Key (Gemini)</label>
                    <input type="password" class="form-input" id="geminiKey" placeholder="AI...">
                    <div class="form-help">For enhanced Gemini access (optional with Google OAuth)</div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" id="cancelApiKeys">Cancel</button>
                    <button type="submit" class="btn-primary">Save Keys</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Floating Action Buttons -->
    <div class="fab-container">
        <button class="fab export" title="Export Conversation">📤</button>
        <button class="fab record" title="Record Audio">🎙️</button>
        <button class="fab" title="New Agent">🤖</button>
    </div>

    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
        // Google OAuth Configuration
        const GOOGLE_CLIENT_ID = '1012411862950-4c4nf0dla6agi6j7ip844oam02b32err.apps.googleusercontent.com';
        
        // AI Platform Authentication Manager
        class AIAuthManager {
            constructor() {
                this.isAuthenticated = false;
                this.userInfo = null;
                this.platformTokens = {};
                this.init();
            }
            
            init() {
                console.log('🏗️ AIAuthManager initialized - waiting for user action');
                // Initialize Google OAuth when library loads
                window.addEventListener('load', () => {
                    if (window.google) {
                        this.initGoogleAuth();
                    }
                });
                
                // Check for stored authentication but don't auto-authenticate
                this.checkStoredAuth();
                
                // Set initial platform states to "ready" instead of trying to authenticate
                this.setInitialPlatformStates();
            }
            
            setInitialPlatformStates() {
                const platforms = ['claude', 'chatgpt', 'gemini'];
                platforms.forEach(platform => {
                    this.updatePlatformStatus(platform, 'ready');
                });
                // Grok always requires manual API key
                this.updatePlatformStatus('grok', 'manual');
            }
            
            initGoogleAuth() {
                google.accounts.id.initialize({
                    client_id: GOOGLE_CLIENT_ID,
                    callback: this.handleGoogleAuth.bind(this),
                    auto_select: false,
                    cancel_on_tap_outside: false
                });
            }
            
            signInWithGoogle() {
                console.log('🔐 Attempting Google Sign In...');
                
                if (!window.google) {
                    console.log('⚠️ Google OAuth library not loaded, showing fallback');
                    this.showFallbackAuth();
                    return;
                }
                
                try {
                    google.accounts.oauth2.initTokenClient({
                        client_id: GOOGLE_CLIENT_ID,
                        scope: 'email profile openid',
                        callback: this.handleTokenResponse.bind(this),
                    }).requestAccessToken();
                } catch (error) {
                    console.error('OAuth error:', error);
                    alert('OAuth temporarily unavailable. Please try Manual API Keys.');
                    this.showFallbackAuth();
                }
            }
            
            handleGoogleAuth(response) {
                // Decode JWT token
                const payload = JSON.parse(atob(response.credential.split('.')[1]));
                this.userInfo = {
                    name: payload.name,
                    email: payload.email,
                    picture: payload.picture
                };
                
                this.setAuthenticatedState(true);
                this.authenticateAIPlatforms();
            }
            
            handleTokenResponse(response) {
                if (response.access_token) {
                    this.platformTokens.google = response.access_token;
                    this.getUserProfile(response.access_token);
                }
            }
            
            async getUserProfile(accessToken) {
                try {
                    const response = await fetch('https://www.googleapis.com/oauth2/v2/userinfo', {
                        headers: {
                            'Authorization': `Bearer ${accessToken}`
                        }
                    });
                    this.userInfo = await response.json();
                    this.setAuthenticatedState(true);
                    this.authenticateAIPlatforms();
                } catch (error) {
                    console.error('Error fetching user profile:', error);
                }
            }
            
            async authenticateAIPlatforms() {
                const platforms = ['claude', 'chatgpt', 'gemini', 'grok'];
                
                for (const platform of platforms) {
                    this.updatePlatformStatus(platform, 'pending');
                    
                    try {
                        await this.authenticateWithPlatform(platform);
                        this.updatePlatformStatus(platform, 'connected');
                    } catch (error) {
                        console.error(`Failed to authenticate with ${platform}:`, error);
                        this.updatePlatformStatus(platform, 'error');
                    }
                }
            }
            
            async authenticateWithPlatform(platform) {
                switch (platform) {
                    case 'claude':
                        return this.authenticateWithClaude();
                    case 'chatgpt':
                        return this.authenticateWithChatGPT();
                    case 'gemini':
                        return this.authenticateWithGemini();
                    case 'grok':
                        return this.authenticateWithGrok();
                    default:
                        throw new Error(`Unknown platform: ${platform}`);
                }
            }
            
            async authenticateWithClaude() {
                // Claude OAuth flow - use Google token for SSO
                // This would typically involve redirecting to Claude's OAuth endpoint
                console.log('🔵 Authenticating with Claude...');
                // Simulate API call
                await new Promise(resolve => setTimeout(resolve, 1000));
                return { success: true, platform: 'claude' };
            }
            
            async authenticateWithChatGPT() {
                // ChatGPT OAuth flow - use Google token for SSO
                console.log('🟢 Authenticating with ChatGPT...');
                await new Promise(resolve => setTimeout(resolve, 1500));
                return { success: true, platform: 'chatgpt' };
            }
            
            async authenticateWithGemini() {
                // Gemini - native Google integration
                console.log('🔶 Authenticating with Gemini...');
                await new Promise(resolve => setTimeout(resolve, 800));
                return { success: true, platform: 'gemini' };
            }
            
            async authenticateWithGrok() {
                // Grok - manual API key required
                console.log('⚡ Grok requires manual API key');
                this.updatePlatformStatus('grok', 'manual');
                throw new Error('Manual API key required');
            }
            
            setAuthenticatedState(authenticated) {
                this.isAuthenticated = authenticated;
                const authBtn = document.getElementById('googleAuthBtn');
                const authStatus = document.getElementById('authStatus');
                
                if (authenticated && this.userInfo) {
                    authBtn.style.display = 'none';
                    authStatus.classList.remove('hidden');
                    
                    const nameEl = authStatus.querySelector('.auth-name');
                    const emailEl = authStatus.querySelector('.auth-email');
                    
                    nameEl.textContent = this.userInfo.name || 'Connected';
                    emailEl.textContent = this.userInfo.email || 'Loading...';
                    
                    // Store authentication
                    this.storeAuth();
                } else {
                    authBtn.style.display = 'flex';
                    authStatus.classList.add('hidden');
                }
            }
            
            updatePlatformStatus(platform, status) {
                const platformEl = document.querySelector(`[data-platform="${platform}"] .platform-indicator`);
                if (platformEl) {
                    platformEl.className = `platform-indicator ${status}`;
                    
                    switch (status) {
                        case 'ready':
                            platformEl.textContent = '○';
                            break;
                        case 'pending':
                            platformEl.textContent = '⏳';
                            break;
                        case 'connected':
                            platformEl.textContent = '✅';
                            break;
                        case 'error':
                            platformEl.textContent = '❌';
                            break;
                        case 'manual':
                            platformEl.textContent = '🔑';
                            break;
                    }
                }
            }
            
            showFallbackAuth() {
                // Show manual API key modal as fallback
                document.getElementById('apiKeysModal').classList.add('show');
            }
            
            storeAuth() {
                // Store authentication state (but not sensitive tokens)
                const authData = {
                    isAuthenticated: this.isAuthenticated,
                    userInfo: this.userInfo,
                    timestamp: Date.now()
                };
                // In a real app, use secure storage
                console.log('Auth stored:', authData);
            }
            
            checkStoredAuth() {
                // Check for existing authentication but don't auto-connect
                console.log('🔍 Checking for stored authentication (passive check)');
                // In a real app, you'd check for valid stored tokens
                // but NOT automatically use them until user initiates sign-in
            }
            
            disconnect() {
                this.isAuthenticated = false;
                this.userInfo = null;
                this.platformTokens = {};
                this.setAuthenticatedState(false);
                
                // Reset platform statuses
                const platforms = ['claude', 'chatgpt', 'gemini', 'grok'];
                platforms.forEach(platform => {
                    if (platform === 'grok') {
                        this.updatePlatformStatus(platform, 'manual');
                    } else {
                        this.updatePlatformStatus(platform, 'pending');
                    }
                });
                
                console.log('🔓 Disconnected from all platforms');
            }
        }
        
        // Initialize Authentication Manager
        const authManager = new AIAuthManager();
        
        // Manual API Keys Manager
        class APIKeysManager {
            constructor() {
                this.keys = {};
                this.loadStoredKeys();
            }
            
            showModal() {
                console.log('🔑 Opening Manual API Keys modal...');
                const modal = document.getElementById('apiKeysModal');
                if (modal) {
                    modal.classList.add('show');
                    console.log('✅ Modal should be visible now');
                } else {
                    console.error('❌ Modal element not found!');
                }
            }
            
            hideModal() {
                document.getElementById('apiKeysModal').classList.remove('show');
            }
            
            saveKeys(keys) {
                this.keys = { ...this.keys, ...keys };
                // In a real app, encrypt and securely store keys
                console.log('API keys saved:', Object.keys(keys));
                
                // Update platform statuses for manually configured platforms
                Object.keys(keys).forEach(platform => {
                    if (keys[platform]) {
                        authManager.updatePlatformStatus(platform, 'connected');
                    }
                });
                
                this.hideModal();
            }
            
            loadStoredKeys() {
                // Load encrypted API keys from secure storage (passive check only)
                console.log('🔍 Checking for stored API keys (passive check)');
                // Don't automatically authenticate - wait for user action
            }
        }
        
        const apiKeysManager = new APIKeysManager();
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // Drawer toggles
        const leftDrawerToggle = document.getElementById('leftDrawerToggle');
        const rightDrawerToggle = document.getElementById('rightDrawerToggle');
        const leftDrawer = document.getElementById('leftDrawer');
        const rightDrawer = document.getElementById('rightDrawer');

        leftDrawerToggle.addEventListener('click', () => {
            leftDrawer.classList.toggle('collapsed');
        });

        rightDrawerToggle.addEventListener('click', () => {
            rightDrawer.classList.toggle('collapsed');
        });

        // AI Tab switching
        const aiTabs = document.querySelectorAll('.ai-tab');
        const chatHeader = document.querySelector('.chat-header');
        
        aiTabs.forEach(tab => {
            tab.addEventListener('click', (e) => {
                if (e.target.classList.contains('tab-close')) {
                    // Close tab
                    tab.remove();
                    return;
                }
                
                // Switch tab
                aiTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Update chat header
                const aiName = tab.dataset.ai;
                const avatar = chatHeader.querySelector('.ai-avatar');
                const title = chatHeader.querySelector('.chat-title');
                const subtitle = chatHeader.querySelector('.chat-subtitle');
                
                const aiConfigs = {
                    claude: { avatar: 'C', title: 'Claude Sonnet 4', subtitle: 'Ready to build your cathedral' },
                    chatgpt: { avatar: 'G', title: 'ChatGPT 4o', subtitle: 'Let\'s create something amazing' },
                    grok: { avatar: 'X', title: 'Grok', subtitle: 'Maximum truth-seeking mode' },
                    gemini: { avatar: 'G', title: 'Gemini Pro', subtitle: 'Multimodal AI assistant' }
                };
                
                const config = aiConfigs[aiName];
                if (config) {
                    avatar.textContent = config.avatar;
                    title.textContent = config.title;
                    subtitle.textContent = config.subtitle;
                }
            });
        });

        // Add new tab
        document.getElementById('addTab').addEventListener('click', () => {
            const newAI = prompt('Enter AI name:');
            if (newAI) {
                const newTab = document.createElement('button');
                newTab.className = 'ai-tab';
                newTab.dataset.ai = newAI.toLowerCase();
                newTab.innerHTML = `${newAI} <span class="tab-close">×</span>`;
                
                document.getElementById('aiTabs').insertBefore(newTab, document.getElementById('addTab'));
                
                // Add event listener to new tab
                newTab.addEventListener('click', (e) => {
                    if (e.target.classList.contains('tab-close')) {
                        newTab.remove();
                        return;
                    }
                    
                    aiTabs.forEach(t => t.classList.remove('active'));
                    newTab.classList.add('active');
                });
            }
        });

        // Message sending
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const chatMessages = document.getElementById('chatMessages');

        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            // Add user message
            const userMessage = document.createElement('div');
            userMessage.className = 'message user';
            userMessage.innerHTML = `
                <div class="message-content">${message}</div>
                <div class="message-meta">You • Just now</div>
            `;
            chatMessages.appendChild(userMessage);

            // Clear input
            messageInput.value = '';
            
            // Auto-scroll
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Simulate AI response
            setTimeout(() => {
                const aiMessage = document.createElement('div');
                aiMessage.className = 'message ai';
                aiMessage.innerHTML = `
                    <div class="message-content">I'm ready to help you build the next part of your AIHub cathedral! What specific feature would you like to implement next?</div>
                    <div class="message-meta">Claude • Just now</div>
                `;
                chatMessages.appendChild(aiMessage);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 1000);
        }

        sendBtn.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Auto-resize textarea
        messageInput.addEventListener('input', () => {
            messageInput.style.height = 'auto';
            messageInput.style.height = messageInput.scrollHeight + 'px';
        });

        // Drawer item interactions
        document.querySelectorAll('.drawer-item').forEach(item => {
            item.addEventListener('click', () => {
                // Remove active from siblings
                item.parentElement.querySelectorAll('.drawer-item').forEach(sibling => {
                    sibling.classList.remove('active');
                });
                // Add active to clicked item
                item.classList.add('active');
                
                // Log action for now (replace with actual functionality)
                console.log('Action:', item.textContent.trim());
            });
        });

        // FAB interactions
        document.querySelectorAll('.fab').forEach(fab => {
            fab.addEventListener('click', () => {
                const title = fab.getAttribute('title');
                console.log('FAB action:', title);
                // Add haptic feedback on mobile
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }
            });
        });

        // Dark theme detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.body.classList.add('dark-theme');
        }

        console.log('🏗️ AIHub PWA initialized - Ready to build your cathedral!');
    </script>
</body>
</html>
